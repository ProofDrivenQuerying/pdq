--Both we and SQL underestimate

--Single hub with two stars and key foreign key joins between the hub and the stars
CREATE VIEW V10
WITH SCHEMABINDING 
AS 
SELECT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.PART, dbo.SUPPLIER
WHERE  
PARTSUPP.PS_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1' AND
PART.P_BRAND = 'Brand#13' AND
PARTSUPP.PS_SUPPKEY = SUPPLIER.S_SUPPKEY AND
SUPPLIER.S_ACCTBAL > 2000;


CREATE UNIQUE CLUSTERED INDEX V10_INDEX ON dbo.V10 (PS_PARTKEY, PS_SUPPKEY);

--Single hub 
CREATE VIEW V11
WITH SCHEMABINDING 
AS 
SELECT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP
WHERE  PARTSUPP.PS_SUPPLYCOST > 500;


CREATE UNIQUE CLUSTERED INDEX V11_INDEX ON dbo.V11 (PS_PARTKEY, PS_SUPPKEY);

--Actual: 11787
--SQL: 6044

SELECT DISTINCT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.PART, dbo.SUPPLIER
WHERE  
PARTSUPP.PS_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1' AND
PART.P_BRAND = 'Brand#13' AND
PARTSUPP.PS_SUPPKEY = SUPPLIER.S_SUPPKEY AND
SUPPLIER.S_ACCTBAL > 2000 AND
PARTSUPP.PS_SUPPLYCOST > 500;

