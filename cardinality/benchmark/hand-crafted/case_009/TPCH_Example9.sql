--Both we and SQL underestimate, but our estimate is closer

--Single hub with single star and key foreign key join
CREATE VIEW V12
WITH SCHEMABINDING 
AS 
SELECT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.PART
WHERE  
PARTSUPP.PS_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1' AND
PART.P_BRAND = 'Brand#13';


CREATE UNIQUE CLUSTERED INDEX V12_INDEX ON dbo.V12 (PS_PARTKEY, PS_SUPPKEY);

--Single hub with single star and key foreign key join
CREATE VIEW V13
WITH SCHEMABINDING 
AS 
SELECT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.SUPPLIER
WHERE  
PARTSUPP.PS_SUPPKEY = SUPPLIER.S_SUPPKEY AND
SUPPLIER.S_ACCTBAL > 2000;


CREATE UNIQUE CLUSTERED INDEX V13_INDEX ON dbo.V13 (PS_PARTKEY, PS_SUPPKEY);


--Actual:11787
--SQL:6044

SELECT DISTINCT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.PART, dbo.SUPPLIER
WHERE  
PARTSUPP.PS_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1' AND
PART.P_BRAND = 'Brand#13' AND
PARTSUPP.PS_SUPPKEY = SUPPLIER.S_SUPPKEY AND
SUPPLIER.S_ACCTBAL > 2000 AND
PARTSUPP.PS_SUPPLYCOST > 500;
