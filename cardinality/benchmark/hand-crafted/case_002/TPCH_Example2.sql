--One order of magnitude win
--Single hub with single star, non key foreign-key joins
--|V1|=1796
CREATE VIEW V1
WITH SCHEMABINDING 
AS
SELECT ORDERS.O_ORDERKEY, PART.P_PARTKEY
FROM dbo.ORDERS, dbo.PART
WHERE PART.P_RETAILPRICE=ORDERS.O_TOTALPRICE AND
PART.P_MFGR='Manufacturer#1'        

CREATE UNIQUE CLUSTERED INDEX V1_INDEX ON dbo.V1 (O_ORDERKEY, P_PARTKEY);

--Single hub 
--|V3|=1202
CREATE VIEW V3
WITH SCHEMABINDING 
AS
SELECT CUSTOMER.C_CUSTKEY
FROM dbo.CUSTOMER
WHERE 
CUSTOMER.C_MKTSEGMENT='AUTOMOBILE' AND
CUSTOMER.C_PHONE LIKE '10-%';

CREATE UNIQUE CLUSTERED INDEX V3_INDEX ON dbo.V3 (C_CUSTKEY);


--Actual: 6
--SQL estimate: 233

SELECT DISTINCT PART.P_PARTKEY
FROM dbo.ORDERS, dbo.PART, dbo.CUSTOMER
WHERE ORDERS.O_CUSTKEY=CUSTOMER.C_CUSTKEY AND 
PART.P_RETAILPRICE=ORDERS.O_TOTALPRICE AND
PART.P_MFGR='Manufacturer#1' AND
CUSTOMER.C_MKTSEGMENT='AUTOMOBILE' AND
CUSTOMER.C_PHONE LIKE '10-%';