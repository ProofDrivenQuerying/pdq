--We underestimate one order of magnitude, SQL overestimates one order of magnitude
--Single hub with single star, key foreign-key join
--|V6|=107376
CREATE VIEW V6
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, PART.P_PARTKEY
FROM dbo.LINEITEM, dbo.PART
WHERE  
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPMODE = 'MAIL';

CREATE UNIQUE CLUSTERED INDEX V6_INDEX ON dbo.V6 (L_ORDERKEY, L_LINENUMBER, P_PARTKEY);

--Single hub with single star, non key foreign-key join
--|V7|=9029
CREATE VIEW V7
WITH SCHEMABINDING 
AS 
SELECT ORDERS.O_ORDERKEY, PART.P_PARTKEY
FROM dbo.ORDERS, dbo.PART
WHERE  
ORDERS.O_TOTALPRICE = PART.P_RETAILPRICE;

CREATE UNIQUE CLUSTERED INDEX V7_INDEX ON dbo.V7 (O_ORDERKEY, P_PARTKEY);


--Actual: 4874
--SQL estimate: 68996

SELECT DISTINCT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, ORDERS.O_ORDERKEY, PART.P_PARTKEY
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART
WHERE  
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPMODE = 'MAIL' AND
ORDERS.O_TOTALPRICE = PART.P_RETAILPRICE;

