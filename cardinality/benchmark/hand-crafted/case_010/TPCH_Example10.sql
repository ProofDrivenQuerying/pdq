--Both we and SQL underestimate, but SQL's estimate is closer

--Single hub with single star and key foreign key join
CREATE VIEW V1
WITH SCHEMABINDING 
AS 
SELECT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.PART
WHERE  
PARTSUPP.PS_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1' AND
PART.P_BRAND = 'Brand#13';

CREATE UNIQUE CLUSTERED INDEX V1_INDEX ON dbo.V1 (PS_PARTKEY, PS_SUPPKEY);

--Single hub with two stars and two key foreign key joins one between the hub and a star and one between the stars
CREATE VIEW V2
WITH SCHEMABINDING 
AS 
SELECT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.SUPPLIER, dbo.NATION
WHERE  
PARTSUPP.PS_SUPPKEY = SUPPLIER.S_SUPPKEY AND
SUPPLIER.S_ACCTBAL > 2000 AND
SUPPLIER.S_NATIONKEY = NATION.N_NATIONKEY AND
NATION.N_NAME LIKE 'UNITED%';

CREATE UNIQUE CLUSTERED INDEX V2_INDEX ON dbo.V2 (PS_PARTKEY, PS_SUPPKEY);


--Actual: 1923
--SQL: 1099

SELECT DISTINCT PARTSUPP.PS_PARTKEY, PARTSUPP.PS_SUPPKEY
FROM dbo.PARTSUPP, dbo.PART, dbo.SUPPLIER, dbo.NATION
WHERE  
PARTSUPP.PS_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1' AND
PART.P_BRAND = 'Brand#13' AND
PARTSUPP.PS_SUPPKEY = SUPPLIER.S_SUPPKEY AND
SUPPLIER.S_ACCTBAL > 2000 AND
SUPPLIER.S_NATIONKEY = NATION.N_NATIONKEY AND
NATION.N_NAME LIKE 'UNITED%';
