
--Single hub 
CREATE VIEW V8
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER
FROM dbo.LINEITEM
WHERE  
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPDATE=LINEITEM.L_COMMITDATE;

CREATE UNIQUE CLUSTERED INDEX V8_INDEX ON dbo.V8 (L_ORDERKEY, L_LINENUMBER);

--Single hub with two stars and two key foreign key joins between the hub and the stars
CREATE VIEW V9
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, PART.P_PARTKEY
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART
WHERE  
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1';


CREATE UNIQUE CLUSTERED INDEX V9_INDEX ON dbo.V9 (L_ORDERKEY, L_LINENUMBER, P_PARTKEY);


--Actual: 1251
--SQL: 44620

SELECT DISTINCT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, PART.P_PARTKEY
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART
WHERE  
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPDATE=LINEITEM.L_COMMITDATE AND
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1';
