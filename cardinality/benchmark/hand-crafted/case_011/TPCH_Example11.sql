

--Single hub with single star, key foreign key join
--|V11|: 107376
CREATE VIEW V11
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, ORDERS.O_ORDERKEY
FROM dbo.LINEITEM, dbo.ORDERS
WHERE  
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPMODE = 'MAIL';

CREATE UNIQUE CLUSTERED INDEX V11_INDEX ON dbo.V11 (L_ORDERKEY, L_LINENUMBER, O_ORDERKEY);

--Single hub with single star, key foreign key join
--|V12|: 1202201
CREATE VIEW V12
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, PART.P_PARTKEY
FROM dbo.LINEITEM, dbo.PART
WHERE  
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
PART.P_MFGR = 'Manufacturer#1';

CREATE UNIQUE CLUSTERED INDEX V12_INDEX ON dbo.V12 (L_ORDERKEY, L_LINENUMBER, P_PARTKEY);


--Single hub with single star, key foreign key join
--|V21|: 783
CREATE VIEW V21
WITH SCHEMABINDING 
AS 
SELECT SUPPLIER.S_SUPPKEY, NATION.N_NATIONKEY
FROM dbo.SUPPLIER, dbo.NATION
WHERE SUPPLIER.S_NATIONKEY = NATION.N_NATIONKEY AND
NATION.N_NAME LIKE 'United%';

CREATE UNIQUE CLUSTERED INDEX V21_INDEX ON dbo.V21 (S_SUPPKEY, N_NATIONKEY);


--Single hub with single star, non key foreign key join
--|V22|: 1315
CREATE VIEW V22
WITH SCHEMABINDING 
AS 
SELECT SUPPLIER.S_SUPPKEY, CUSTOMER.C_CUSTKEY
FROM dbo.SUPPLIER, dbo.CUSTOMER
WHERE 
SUPPLIER.S_ACCTBAL = CUSTOMER.C_ACCTBAL;

CREATE UNIQUE CLUSTERED INDEX V22_INDEX ON dbo.V22 (S_SUPPKEY, C_CUSTKEY);


--Actual: 201
--SQL: 5986

SELECT DISTINCT ORDERS.O_ORDERKEY, PART.P_PARTKEY, NATION.N_NATIONKEY, CUSTOMER.C_CUSTKEY
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART, dbo.SUPPLIER, dbo.NATION, dbo.CUSTOMER
WHERE  
LINEITEM.L_SUPPKEY = SUPPLIER.S_SUPPKEY AND
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPMODE = 'MAIL' AND
SUPPLIER.S_NATIONKEY = NATION.N_NATIONKEY AND
SUPPLIER.S_ACCTBAL = CUSTOMER.C_ACCTBAL AND
NATION.N_NAME LIKE 'United%' AND
PART.P_MFGR = 'Manufacturer#1';
