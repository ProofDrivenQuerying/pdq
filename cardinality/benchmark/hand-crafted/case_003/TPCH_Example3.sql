--One order of magnitude win
--Single hub with two stars, all joins are key foreign-key joins
--|V4|=107376
CREATE VIEW V4
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, ORDERS.O_ORDERKEY, PART.P_PARTKEY
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART
WHERE  
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPMODE = 'MAIL';

CREATE UNIQUE CLUSTERED INDEX V4_INDEX ON dbo.V4 (L_ORDERKEY, L_LINENUMBER, O_ORDERKEY, P_PARTKEY);

--Single hub with two stars, there is one key foreign-key join and one non key foreign-key join between the stars and the hub
--|V5|=1315
CREATE VIEW V5
WITH SCHEMABINDING 
AS 
SELECT SUPPLIER.S_SUPPKEY, NATION.N_NATIONKEY, CUSTOMER.C_CUSTKEY
FROM dbo.SUPPLIER, dbo.NATION, dbo.CUSTOMER
WHERE SUPPLIER.S_NATIONKEY = NATION.N_NATIONKEY AND
SUPPLIER.S_ACCTBAL = CUSTOMER.C_ACCTBAL

CREATE UNIQUE CLUSTERED INDEX V5_INDEX ON dbo.V5 (S_SUPPKEY, N_NATIONKEY, C_CUSTKEY);


--Actual: 13940
--SQL estimate: 326421

SELECT DISTINCT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, ORDERS.O_ORDERKEY, PART.P_PARTKEY, NATION.N_NATIONKEY, CUSTOMER.C_CUSTKEY
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART, dbo.SUPPLIER, dbo.NATION, dbo.CUSTOMER
WHERE  
LINEITEM.L_SUPPKEY = SUPPLIER.S_SUPPKEY AND
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
LINEITEM.L_PARTKEY = PART.P_PARTKEY AND
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPINSTRUCT = 'TAKE BACK RETURN' AND
LINEITEM.L_SHIPMODE = 'MAIL' AND
SUPPLIER.S_NATIONKEY = NATION.N_NATIONKEY AND
SUPPLIER.S_ACCTBAL = CUSTOMER.C_ACCTBAL