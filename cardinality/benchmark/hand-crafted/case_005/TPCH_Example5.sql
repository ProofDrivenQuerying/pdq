
--Single hub 
CREATE VIEW V8
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER
FROM dbo.LINEITEM
WHERE  
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPDATE=LINEITEM.L_COMMITDATE;


CREATE UNIQUE CLUSTERED INDEX V8_INDEX ON dbo.V8 (L_ORDERKEY, L_LINENUMBER);

--Single hub with two stars, there is one key foreign-key join and one non key foreign-key join
CREATE VIEW V9
WITH SCHEMABINDING 
AS 
SELECT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER, PART.P_PARTKEY
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART
WHERE  
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
ORDERS.O_TOTALPRICE = PART.P_RETAILPRICE;

CREATE UNIQUE CLUSTERED INDEX V9_INDEX ON dbo.V9 (L_ORDERKEY, L_LINENUMBER, P_PARTKEY);


--Actual: 6
--SQL: 997

SELECT DISTINCT LINEITEM.L_ORDERKEY, LINEITEM.L_LINENUMBER
FROM dbo.LINEITEM, dbo.ORDERS, dbo.PART
WHERE  
LINEITEM.L_RETURNFLAG = 'N' AND
LINEITEM.L_LINESTATUS = 'O' AND
LINEITEM.L_SHIPDATE=LINEITEM.L_COMMITDATE AND
LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY AND
ORDERS.O_TOTALPRICE = PART.P_RETAILPRICE;

