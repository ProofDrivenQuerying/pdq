
--Single hub with single star, key-foreign key join with the hub
--|V1| = 24484
CREATE VIEW V1
WITH SCHEMABINDING 
AS
SELECT ORDERS.O_ORDERKEY, LINEITEM.L_LINENUMBER
FROM dbo.ORDERS, dbo.LINEITEM
WHERE ORDERS.O_ORDERKEY = LINEITEM.L_ORDERKEY AND
LINEITEM.L_COMMITDATE=LINEITEM.L_RECEIPTDATE AND
LINEITEM.L_LINESTATUS = 'O';

CREATE UNIQUE CLUSTERED INDEX V1_INDEX ON dbo.V1 (O_ORDERKEY, L_LINENUMBER);

--Single hub with single stars, key-foreign key join with the hub and the star
--|V2| = 150000
CREATE VIEW V2 
WITH SCHEMABINDING 
AS
SELECT CUSTOMER.C_CUSTKEY, NATION.N_NATIONKEY
FROM dbo.NATION, dbo.CUSTOMER
WHERE NATION.N_NATIONKEY = CUSTOMER.C_NATIONKEY;

CREATE UNIQUE CLUSTERED INDEX V2_INDEX ON dbo.V2 (C_CUSTKEY, N_NATIONKEY);

--Actual: 175
--SQL estimate: 175

SELECT DISTINCT LINEITEM.L_LINENUMBER, NATION.N_NATIONKEY
FROM dbo.ORDERS, dbo.LINEITEM, dbo.CUSTOMER, dbo.NATION
WHERE ORDERS.O_CUSTKEY=CUSTOMER.C_CUSTKEY AND 
ORDERS.O_ORDERKEY = LINEITEM.L_ORDERKEY AND
LINEITEM.L_COMMITDATE=LINEITEM.L_RECEIPTDATE AND
LINEITEM.L_LINESTATUS = 'O' AND
NATION.N_NATIONKEY = CUSTOMER.C_NATIONKEY;