--Times win

--Single hub with single star, non key-foreign key join with the hub
--|V1|=1796
CREATE VIEW V1
WITH SCHEMABINDING 
AS
SELECT ORDERS.O_ORDERKEY, PART.P_PARTKEY
FROM dbo.ORDERS, dbo.PART
WHERE PART.P_RETAILPRICE=ORDERS.O_TOTALPRICE AND
PART.P_MFGR='Manufacturer#1'        

CREATE UNIQUE CLUSTERED INDEX V1_INDEX ON dbo.V1 (O_ORDERKEY, P_PARTKEY);

--Single hub with single stars, key-foreign key join with the hub and the star
--|V2|=150000
CREATE VIEW V2 
WITH SCHEMABINDING 
AS
SELECT CUSTOMER.C_CUSTKEY, NATION.N_NATIONKEY
FROM dbo.NATION, dbo.CUSTOMER
WHERE NATION.N_NATIONKEY = CUSTOMER.C_NATIONKEY;

CREATE UNIQUE CLUSTERED INDEX V2_INDEX ON dbo.V2 (C_CUSTKEY, N_NATIONKEY);

--Actual: 1793
--SQL estimate: 8271
SELECT DISTINCT PART.P_PARTKEY, NATION.N_NATIONKEY
FROM dbo.ORDERS, dbo.PART, dbo.CUSTOMER, dbo.NATION
WHERE ORDERS.O_CUSTKEY=CUSTOMER.C_CUSTKEY AND 
PART.P_RETAILPRICE=ORDERS.O_TOTALPRICE AND
PART.P_MFGR='Manufacturer#1' AND
NATION.N_NATIONKEY = CUSTOMER.C_NATIONKEY;