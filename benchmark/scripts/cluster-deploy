#!/bin/bash

#
# ARG1: location of the project folder (where the JAR files are stored)
#

source cluster-settings

rcp="scp -C"

typeset -i i=0

# Sending out the jar files to all instances
for instance in ${instances[@]};
do hostname="${prefix}${instances[${i}]}${suffix}" 
   echo "Preparing test folder on ${hostname}..." 
   ssh ${keypair} ${hostname} rm -Rf ${deploydir}
   ssh ${keypair} ${hostname} mkdir -p ${deploydir}/lib/
   ssh ${keypair} ${hostname} mkdir -p ${testdir}
   ${rcp} ${keypair} $1 ${hostname}:${deploydir}/pdq-benchmark.jar
   ${rcp} ${keypair} $2 ${hostname}:~
   ${rcp} ${keypair} recursive-run ${hostname}:${deploydir}
   i+=1
done

