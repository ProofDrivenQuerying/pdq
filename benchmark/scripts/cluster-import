#!/bin/bash

#
# ARG1: location of the project folder (where the JAR files are stored)
#

source cluster-settings

rcp="scp -C"

typeset -i i=0

# Sending out the jar files to all instances
for instance in ${instances[@]};
do hostname="${prefix}${instances[${i}]}${suffix}" 
   echo "Preparing test folder on ${hostname}..."   
   ssh ${keypair}  ${hostname} mkdir -p archives/$1
   ssh ${keypair}  ${hostname} mv deploy/test/ archives/$1
   ssh ${keypair}  ${hostname} tar -f archives/$1.tar -r archives/$1/*
   ssh ${keypair}  ${hostname} gzip archives/$1.tar
   ${rcp} ${keypair}  ${hostname}:archives/$1.tar.gz results-${hostname}-$1.tar.gz
   i+=1
done

